<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GUARDIAN | Alerts & Watchlist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body { background: #0a0a0f; font-family: 'Inter', sans-serif; }
        .card { background: rgba(15, 15, 26, 0.9); border: 1px solid rgba(34, 211, 238, 0.1); }
        .scrollbar::-webkit-scrollbar { width: 4px; }
        .scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 2px; }
        .alert-new { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body class="text-slate-100 min-h-screen" x-data="alertsApp()" x-init="init()">
    <!-- Header -->
    <header class="border-b border-slate-800/50 bg-black/50 backdrop-blur-xl sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-6">
                <a href="../../" class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-cyan-500 to-cyan-600 flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                        </svg>
                    </div>
                    <span class="font-bold">GUARDIAN</span>
                </a>
                <nav class="hidden md:flex items-center gap-4">
                    <a href="../dashboard/" class="text-slate-400 hover:text-white text-sm">Dashboard</a>
                    <a href="../leaderboard/" class="text-slate-400 hover:text-white text-sm">Leaderboard</a>
                    <span class="text-cyan-400 text-sm font-medium">Alerts</span>
                </nav>
            </div>
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-red-500/10 border border-red-500/30" x-show="unreadCount > 0">
                    <span class="text-red-400 text-sm font-medium" x-text="unreadCount + ' new'"></span>
                </div>
            </div>
        </div>
    </header>
    
    <main class="max-w-7xl mx-auto px-6 py-8">
        <div class="grid lg:grid-cols-3 gap-6">
            <!-- Alerts Feed -->
            <div class="lg:col-span-2">
                <div class="card rounded-xl">
                    <div class="px-4 py-3 border-b border-slate-800/50 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="font-medium text-white">üîî Alert Feed</span>
                            <span x-show="alerts.length > 0" class="px-2 py-0.5 rounded bg-red-500/10 text-red-400 text-xs" x-text="alerts.length"></span>
                        </div>
                        <div class="flex gap-2">
                            <button @click="clearAlerts()" class="text-xs text-slate-500 hover:text-white">Clear All</button>
                        </div>
                    </div>
                    <div class="max-h-[600px] overflow-y-auto scrollbar">
                        <template x-for="alert in alerts" :key="alert.id">
                            <div class="px-4 py-4 border-b border-slate-800/30 hover:bg-slate-800/20 alert-new" :class="!alert.read && 'bg-slate-800/10'">
                                <div class="flex items-start gap-4">
                                    <div class="w-10 h-10 rounded-xl flex items-center justify-center text-xl" :class="getAlertBg(alert.type)">
                                        <span x-text="getAlertEmoji(alert.type)"></span>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="font-medium text-white" x-text="alert.title"></span>
                                            <span class="px-1.5 py-0.5 rounded text-[10px]" :class="getAlertTypeBg(alert.type)" x-text="alert.type"></span>
                                        </div>
                                        <p class="text-sm text-slate-400 mb-2" x-text="alert.message"></p>
                                        <div class="flex items-center gap-4 text-xs text-slate-600">
                                            <span x-text="formatTime(alert.timestamp)"></span>
                                            <template x-if="alert.token">
                                                <a :href="'../dashboard/?scan=' + alert.token" class="text-cyan-400 hover:text-cyan-300">View Token ‚Üí</a>
                                            </template>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xl font-bold" :class="getSeverityColor(alert.severity)" x-text="alert.severity"></div>
                                    </div>
                                </div>
                            </div>
                        </template>
                        
                        <div x-show="alerts.length === 0" class="p-12 text-center text-slate-500">
                            <div class="text-4xl mb-3">üîï</div>
                            <p>No alerts yet</p>
                            <p class="text-sm mt-1">Add tokens to your watchlist to receive alerts</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Watchlist & Settings -->
            <div class="space-y-6">
                <!-- Add to Watchlist -->
                <div class="card rounded-xl p-4">
                    <div class="text-sm font-medium text-white mb-3">‚ûï Add to Watchlist</div>
                    <form @submit.prevent="addToWatchlist()">
                        <input type="text" x-model="newWatchToken" placeholder="Token mint address..." class="w-full px-3 py-2 rounded-lg bg-slate-900 border border-slate-700 text-white text-sm font-mono focus:border-cyan-500 focus:outline-none mb-3">
                        <div class="flex gap-2 mb-3">
                            <label class="flex items-center gap-2 text-xs text-slate-400">
                                <input type="checkbox" x-model="watchSettings.priceChange" class="rounded bg-slate-800 border-slate-700">
                                Price ¬±10%
                            </label>
                            <label class="flex items-center gap-2 text-xs text-slate-400">
                                <input type="checkbox" x-model="watchSettings.whaleActivity" class="rounded bg-slate-800 border-slate-700">
                                Whale Activity
                            </label>
                            <label class="flex items-center gap-2 text-xs text-slate-400">
                                <input type="checkbox" x-model="watchSettings.riskChange" class="rounded bg-slate-800 border-slate-700">
                                Risk Change
                            </label>
                        </div>
                        <button type="submit" class="w-full py-2 rounded-lg bg-gradient-to-r from-cyan-500 to-cyan-600 text-white text-sm font-medium">Add Token</button>
                    </form>
                </div>
                
                <!-- Watchlist -->
                <div class="card rounded-xl">
                    <div class="px-4 py-3 border-b border-slate-800/50 flex items-center justify-between">
                        <span class="text-sm font-medium text-white">üëÅÔ∏è Watchlist</span>
                        <span class="text-xs text-slate-500" x-text="watchlist.length + ' tokens'"></span>
                    </div>
                    <div class="max-h-80 overflow-y-auto scrollbar">
                        <template x-for="token in watchlist" :key="token.mint">
                            <div class="px-4 py-3 border-b border-slate-800/30 hover:bg-slate-800/20 flex items-center gap-3">
                                <img :src="token.image" class="w-8 h-8 rounded-lg bg-slate-800" onerror="this.src='https://via.placeholder.com/32'">
                                <div class="flex-1 min-w-0">
                                    <div class="text-sm font-medium text-white truncate" x-text="token.name || 'Loading...'"></div>
                                    <div class="text-xs text-slate-500 font-mono truncate" x-text="token.mint.slice(0, 8) + '...'"></div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm font-bold" :class="getSeverityColor(token.risk_score || 50)" x-text="token.risk_score || '-'"></div>
                                </div>
                                <button @click="removeFromWatchlist(token.mint)" class="text-slate-600 hover:text-red-400">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                                </button>
                            </div>
                        </template>
                        
                        <div x-show="watchlist.length === 0" class="p-6 text-center text-slate-500 text-sm">
                            No tokens in watchlist
                        </div>
                    </div>
                </div>
                
                <!-- Alert Settings -->
                <div class="card rounded-xl p-4">
                    <div class="text-sm font-medium text-white mb-4">‚öôÔ∏è Alert Settings</div>
                    <div class="space-y-3">
                        <label class="flex items-center justify-between">
                            <span class="text-sm text-slate-400">New Threats</span>
                            <input type="checkbox" x-model="settings.newThreats" class="rounded bg-slate-800 border-slate-700 text-cyan-500">
                        </label>
                        <label class="flex items-center justify-between">
                            <span class="text-sm text-slate-400">Whale Movements</span>
                            <input type="checkbox" x-model="settings.whaleMovements" class="rounded bg-slate-800 border-slate-700 text-cyan-500">
                        </label>
                        <label class="flex items-center justify-between">
                            <span class="text-sm text-slate-400">Honeypot Detected</span>
                            <input type="checkbox" x-model="settings.honeypots" class="rounded bg-slate-800 border-slate-700 text-cyan-500">
                        </label>
                        <label class="flex items-center justify-between">
                            <span class="text-sm text-slate-400">Lazarus Activity</span>
                            <input type="checkbox" x-model="settings.lazarus" class="rounded bg-slate-800 border-slate-700 text-cyan-500">
                        </label>
                    </div>
                </div>
                
                <!-- Quick Stats -->
                <div class="card rounded-xl p-4">
                    <div class="text-sm font-medium text-white mb-4">üìä Alert Stats</div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="p-3 rounded-lg bg-slate-900/50 text-center">
                            <div class="text-xl font-bold text-red-400" x-text="stats.critical"></div>
                            <div class="text-xs text-slate-500">Critical</div>
                        </div>
                        <div class="p-3 rounded-lg bg-slate-900/50 text-center">
                            <div class="text-xl font-bold text-orange-400" x-text="stats.high"></div>
                            <div class="text-xs text-slate-500">High</div>
                        </div>
                        <div class="p-3 rounded-lg bg-slate-900/50 text-center">
                            <div class="text-xl font-bold text-yellow-400" x-text="stats.medium"></div>
                            <div class="text-xs text-slate-500">Medium</div>
                        </div>
                        <div class="p-3 rounded-lg bg-slate-900/50 text-center">
                            <div class="text-xl font-bold text-green-400" x-text="stats.low"></div>
                            <div class="text-xs text-slate-500">Low</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="../dashboard/api.js"></script>
    <script>
        function alertsApp() {
            return {
                alerts: [],
                watchlist: [],
                newWatchToken: '',
                watchSettings: { priceChange: true, whaleActivity: true, riskChange: true },
                settings: { newThreats: true, whaleMovements: true, honeypots: true, lazarus: true },
                stats: { critical: 0, high: 0, medium: 0, low: 0 },
                
                get unreadCount() { return this.alerts.filter(a => !a.read).length; },
                
                init() {
                    this.loadWatchlist();
                    this.generateSampleAlerts();
                    this.startMonitoring();
                },
                
                loadWatchlist() {
                    const saved = localStorage.getItem('guardian_watchlist');
                    if (saved) this.watchlist = JSON.parse(saved);
                },
                
                saveWatchlist() {
                    localStorage.setItem('guardian_watchlist', JSON.stringify(this.watchlist));
                },
                
                async addToWatchlist() {
                    if (!this.newWatchToken) return;
                    
                    const tokenData = await GuardianAPI.getTokenInfo(this.newWatchToken);
                    const analysis = tokenData ? GuardianAPI.analyzeToken(tokenData) : { mint: this.newWatchToken };
                    
                    if (!this.watchlist.find(t => t.mint === this.newWatchToken)) {
                        this.watchlist.push({
                            mint: this.newWatchToken,
                            name: analysis.name || 'Unknown',
                            symbol: analysis.symbol,
                            image: analysis.image,
                            risk_score: analysis.risk_score,
                            settings: { ...this.watchSettings }
                        });
                        this.saveWatchlist();
                        
                        this.addAlert({
                            type: 'info',
                            title: 'Token Added',
                            message: `${analysis.name || 'Token'} added to watchlist`,
                            severity: 0
                        });
                    }
                    
                    this.newWatchToken = '';
                },
                
                removeFromWatchlist(mint) {
                    this.watchlist = this.watchlist.filter(t => t.mint !== mint);
                    this.saveWatchlist();
                },
                
                generateSampleAlerts() {
                    const types = ['threat', 'whale', 'honeypot', 'info'];
                    const samples = [
                        { type: 'honeypot', title: 'Honeypot Detected', message: 'Token XYZ123 identified as honeypot - sell function blocked', severity: 95 },
                        { type: 'whale', title: 'Whale Movement', message: 'Large holder sold $500K worth of tokens', severity: 65 },
                        { type: 'threat', title: 'Rug Pull Risk', message: 'Liquidity decreased by 40% in 1 hour', severity: 85 },
                        { type: 'info', title: 'Risk Score Changed', message: 'Watched token risk increased from 30 to 55', severity: 55 }
                    ];
                    
                    samples.forEach((s, i) => {
                        setTimeout(() => this.addAlert(s), i * 100);
                    });
                },
                
                addAlert(alert) {
                    this.alerts.unshift({
                        id: Date.now() + Math.random(),
                        ...alert,
                        timestamp: Date.now(),
                        read: false
                    });
                    this.updateStats();
                },
                
                clearAlerts() {
                    this.alerts = [];
                    this.updateStats();
                },
                
                updateStats() {
                    this.stats = {
                        critical: this.alerts.filter(a => a.severity >= 80).length,
                        high: this.alerts.filter(a => a.severity >= 60 && a.severity < 80).length,
                        medium: this.alerts.filter(a => a.severity >= 40 && a.severity < 60).length,
                        low: this.alerts.filter(a => a.severity < 40).length
                    };
                },
                
                startMonitoring() {
                    // Check watchlist every 60 seconds
                    setInterval(async () => {
                        for (const token of this.watchlist) {
                            const data = await GuardianAPI.getTokenInfo(token.mint);
                            if (data) {
                                const analysis = GuardianAPI.analyzeToken(data);
                                
                                // Check for risk change
                                if (token.settings.riskChange && token.risk_score && Math.abs(analysis.risk_score - token.risk_score) > 15) {
                                    this.addAlert({
                                        type: 'threat',
                                        title: 'Risk Score Changed',
                                        message: `${token.name} risk changed from ${token.risk_score} to ${analysis.risk_score}`,
                                        severity: analysis.risk_score,
                                        token: token.mint
                                    });
                                }
                                
                                // Update stored risk
                                token.risk_score = analysis.risk_score;
                            }
                        }
                        this.saveWatchlist();
                    }, 60000);
                },
                
                getAlertEmoji(type) {
                    const emojis = { threat: '‚ö†Ô∏è', whale: 'üêã', honeypot: 'üçØ', info: '‚ÑπÔ∏è', lazarus: 'üá∞üáµ' };
                    return emojis[type] || 'üîî';
                },
                
                getAlertBg(type) {
                    const bgs = { threat: 'bg-red-500/10', whale: 'bg-purple-500/10', honeypot: 'bg-orange-500/10', info: 'bg-cyan-500/10', lazarus: 'bg-red-500/10' };
                    return bgs[type] || 'bg-slate-800';
                },
                
                getAlertTypeBg(type) {
                    const bgs = { threat: 'bg-red-500/10 text-red-400', whale: 'bg-purple-500/10 text-purple-400', honeypot: 'bg-orange-500/10 text-orange-400', info: 'bg-cyan-500/10 text-cyan-400' };
                    return bgs[type] || 'bg-slate-800 text-slate-400';
                },
                
                getSeverityColor(s) {
                    if (s >= 70) return 'text-red-500';
                    if (s >= 50) return 'text-orange-500';
                    if (s >= 30) return 'text-yellow-500';
                    return 'text-green-500';
                },
                
                formatTime(ts) {
                    const diff = Date.now() - ts;
                    if (diff < 60000) return 'just now';
                    if (diff < 3600000) return Math.floor(diff/60000) + 'm ago';
                    if (diff < 86400000) return Math.floor(diff/3600000) + 'h ago';
                    return Math.floor(diff/86400000) + 'd ago';
                }
            };
        }
    </script>
</body>
</html>
